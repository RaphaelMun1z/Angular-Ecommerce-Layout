<div class="min-h-screen bg-white flex flex-col md:flex-row font-sans">
    
    <!-- Painel Lateral (Stepper / Progress) -->
    <aside class="w-full md:w-[320px] lg:w-[380px] bg-[#FAFAFA] border-r border-gray-100 p-8 md:p-12 flex flex-col min-h-[200px] md:min-h-screen">
        
        <!-- Logo / Voltar -->
        <div class="flex items-center gap-3 mb-12">
            <button routerLink="/dashboard-admin" class="w-8 h-8 rounded-lg bg-emerald-50 flex items-center justify-center text-emerald-600 hover:bg-emerald-100 transition-colors cursor-pointer">
                <i class="ph-bold ph-arrow-left text-lg"></i>
            </button>
            <h1 class="text-xl font-bold text-gray-900 tracking-tight">Novo Cliente</h1>
        </div>

        <!-- Passos -->
        <div class="flex-1">
            <div class="flex flex-col gap-8 relative">
                @for (step of steps; track step.id; let isLast = $last) {
                    <div class="relative flex gap-5">
                        
                        <!-- Linha de conexão vertical -->
                        @if (!isLast) {
                            <div class="absolute left-4 top-10 bottom-[-2rem] w-[2px]"
                                 [ngClass]="currentStep() > step.id ? 'bg-emerald-500' : 'bg-gray-200'">
                            </div>
                        }

                        <!-- Círculo do Passo -->
                        <div class="w-8 h-8 rounded-full flex items-center justify-center shrink-0 relative z-10 transition-colors duration-300"
                             [ngClass]="getStepCircleClass(step.id)">
                            @if (currentStep() > step.id) {
                                <i class="ph-bold ph-check text-sm text-white"></i>
                            } @else {
                                <i [class]="'ph-bold text-sm ' + step.icon" [ngClass]="currentStep() === step.id ? 'text-emerald-600' : 'text-gray-400'"></i>
                            }
                        </div>

                        <!-- Textos do Passo -->
                        <div class="pb-2">
                            <p class="text-[11px] font-bold uppercase tracking-widest mb-0.5"
                               [ngClass]="currentStep() === step.id ? 'text-gray-900' : 'text-gray-500'">
                                Passo {{ step.id }}
                            </p>
                            <h3 class="text-[15px] font-semibold"
                                [ngClass]="currentStep() >= step.id ? 'text-gray-900' : 'text-gray-400'">
                                {{ step.title }}
                            </h3>
                            <p class="text-[13px] font-medium mt-1"
                               [ngClass]="currentStep() === step.id ? 'text-emerald-600' : 'text-gray-400'">
                                @if (currentStep() > step.id) { Completo }
                                @else if (currentStep() === step.id) { Em progresso }
                                @else { Pendente }
                            </p>
                        </div>
                    </div>
                }
            </div>
        </div>
    </aside>

    <!-- Área Principal do Formulário -->
    <main class="flex-1 flex flex-col relative bg-white">
        
        <!-- Header da Área de Form -->
        <header class="flex items-center justify-between p-6 md:px-12 md:py-8">
            <button (click)="prevStep()" 
                    class="flex items-center gap-2 text-sm font-semibold text-gray-500 hover:text-gray-900 transition-colors cursor-pointer"
                    [class.invisible]="currentStep() === 1">
                <div class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center"><i class="ph-bold ph-caret-left"></i></div>
                Voltar
            </button>
            <div class="text-sm font-semibold text-gray-400 flex items-center gap-1.5">
                Rascunho salvo <i class="ph-fill ph-cloud-check text-emerald-500 text-lg"></i>
            </div>
        </header>

        <!-- Container do Formulário Centrado -->
        <div class="flex-1 flex flex-col max-w-[500px] w-full mx-auto px-6 pb-20 animate-fade-in pt-4 md:pt-8">
            
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-gray-900 tracking-tight mb-3">{{ currentStepData().title }}</h2>
                <p class="text-[15px] text-gray-500 font-medium">{{ currentStepData().desc }}</p>
            </div>

            <form [formGroup]="customerForm" class="flex-1">
                
                <!-- PASSO 1: DADOS PESSOAIS -->
                @if (currentStep() === 1) {
                    <div class="space-y-5 animate-fade-in">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">Nome Completo</label>
                            <input type="text" formControlName="name" placeholder="Ex: Maria Oliveira" 
                                   class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            @if (isFieldInvalid('name')) { <p class="text-xs text-red-500 mt-1.5">Nome é obrigatório (mín. 3 letras).</p> }
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">CPF</label>
                            <input type="text" formControlName="document" mask="000.000.000-00" placeholder="000.000.000-00" 
                                   class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            @if (isFieldInvalid('document')) { <p class="text-xs text-red-500 mt-1.5">CPF é obrigatório.</p> }
                        </div>
                    </div>
                }

                <!-- PASSO 2: CONTATO E ACESSO -->
                @if (currentStep() === 2) {
                    <div class="space-y-5 animate-fade-in">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">E-mail de Acesso</label>
                            <input type="email" formControlName="email" placeholder="cliente@email.com" 
                                   class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            @if (isFieldInvalid('email')) { <p class="text-xs text-red-500 mt-1.5">E-mail válido obrigatório.</p> }
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">WhatsApp / Celular</label>
                            <input type="tel" formControlName="phone" mask="(00) 0 0000-0000" placeholder="(00) 0 0000-0000" 
                                   class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">Senha Provisória</label>
                            <input type="text" formControlName="password" placeholder="Mínimo 6 caracteres" 
                                   class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 font-mono outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            @if (isFieldInvalid('password')) { <p class="text-xs text-red-500 mt-1.5">Mínimo 6 caracteres.</p> }
                            <p class="text-[11px] text-gray-400 mt-2 font-medium">O cliente poderá alterar no primeiro acesso ao painel.</p>
                        </div>
                    </div>
                }

                <!-- PASSO 3: ENDEREÇO -->
                @if (currentStep() === 3) {
                    <div class="space-y-5 animate-fade-in">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1.5">CEP</label>
                                <div class="relative">
                                    <input type="text" formControlName="zipCode" mask="00000-000" (blur)="buscarCep()" placeholder="00000-000" 
                                           class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all pr-12 placeholder:text-gray-400">
                                    @if (isLoadingCep()) {
                                        <div class="absolute right-4 top-1/2 -translate-y-1/2">
                                            <i class="ph-bold ph-spinner animate-spin text-emerald-600"></i>
                                        </div>
                                    }
                                </div>
                                @if (isFieldInvalid('zipCode')) { <p class="text-xs text-red-500 mt-1.5">Obrigatório.</p> }
                            </div>
                            
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1.5">Logradouro</label>
                                <input type="text" formControlName="street" placeholder="Rua, Avenida..." 
                                       class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5">Número</label>
                                <input type="text" formControlName="number" placeholder="123" 
                                       class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5">Complemento</label>
                                <input type="text" formControlName="complement" placeholder="Apto, Sala..." 
                                       class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            </div>

                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1.5">Bairro</label>
                                <input type="text" formControlName="neighborhood" placeholder="Bairro" 
                                       class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                            </div>

                            <div class="col-span-2 flex gap-4">
                                <div class="flex-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Cidade</label>
                                    <input type="text" formControlName="city" placeholder="Cidade" 
                                           class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400">
                                </div>
                                <div class="w-24">
                                    <label class="block text-sm font-medium text-gray-700 mb-1.5">UF</label>
                                    <input type="text" formControlName="state" maxlength="2" placeholder="UF" 
                                           class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all uppercase placeholder:text-gray-400 text-center">
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!-- PASSO 4: PERFIL E REVISÃO -->
                @if (currentStep() === 4) {
                    <div class="space-y-6 animate-fade-in">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">Grupo do Cliente</label>
                            <div class="relative">
                                <select formControlName="group" class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all appearance-none cursor-pointer">
                                    <option value="retail">Consumidor Final (Varejo)</option>
                                    <option value="wholesale">Parceiro / Construtora</option>
                                    <option value="vip">Cliente VIP</option>
                                </select>
                                <i class="ph-bold ph-caret-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                            </div>
                        </div>

                        <label class="flex items-center cursor-pointer gap-4 p-4 border border-gray-200 rounded-xl hover:border-emerald-500 transition-colors">
                            <div class="relative">
                                <input type="checkbox" formControlName="newsletter" class="peer sr-only">
                                <div class="w-12 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                            </div>
                            <div>
                                <span class="block text-sm font-bold text-gray-900">Ativar Newsletter</span>
                                <span class="block text-xs text-gray-500 mt-0.5">Permitir envio de e-mails sobre compras e alertas.</span>
                            </div>
                        </label>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">Observações Internas</label>
                            <textarea formControlName="notes" rows="4" placeholder="Notas sobre o cliente para visualização exclusiva do Admin." 
                                      class="w-full border border-gray-200 rounded-xl p-3.5 text-[15px] text-gray-900 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder:text-gray-400 resize-none"></textarea>
                        </div>
                    </div>
                }
                
                <!-- Botão Fixo na parte inferior do form -->
                <div class="mt-12">
                    @if (currentStep() < steps.length) {
                        <button type="button" (click)="nextStep()" 
                                class="w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl text-[15px] transition-colors shadow-lg shadow-emerald-500/20 active:scale-[0.99] cursor-pointer">
                            Próximo Passo
                        </button>
                    } @else {
                        <button type="button" (click)="onSubmit()" [disabled]="isLoading()"
                                class="w-full py-4 bg-gray-900 hover:bg-black text-white font-bold rounded-xl text-[15px] transition-colors shadow-lg shadow-gray-900/20 active:scale-[0.99] cursor-pointer disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                            @if (isLoading()) {
                                <i class="ph-bold ph-spinner animate-spin"></i> Finalizando...
                            } @else {
                                <i class="ph-bold ph-check-circle"></i> Concluir Cadastro
                            }
                        </button>
                    }
                </div>

            </form>
        </div>
    </main>
</div>