<!-- 
  DICA DE CSS: Para a classe 'cart-scroll' funcionar bem, adicione isso no seu styles.css global:
  .cart-scroll::-webkit-scrollbar { width: 4px; }
  .cart-scroll::-webkit-scrollbar-track { background: transparent; }
  .cart-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
  .cart-scroll:hover::-webkit-scrollbar-thumb { background: #94a3b8; }
-->

<div
    class="absolute right-0 top-full w-80 sm:w-96 bg-white/95 backdrop-blur-xl rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.1)] border border-slate-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top-right z-50 overflow-hidden translate-y-2 group-hover:translate-y-0 mt-3 flex flex-col"
>
    <!-- Cabeçalho -->
    <div
        class="px-6 py-4 border-b border-slate-100 bg-white/50 flex justify-between items-center shrink-0"
    >
        <h3 class="font-bold text-slate-900 text-base tracking-tight">
            Meu Carrinho
        </h3>
        @if (carrinhoService.quantidadeItens() > 0) {
            <span
                class="text-xs font-bold text-white bg-slate-900 px-2.5 py-0.5 rounded-full shadow-sm"
            >
                {{ carrinhoService.quantidadeItens() }}
                {{ carrinhoService.quantidadeItens() === 1 ? "item" : "itens" }}
            </span>
        }
    </div>

    <!-- Lista de Itens -->
    <div
        class="max-h-[360px] overflow-y-auto cart-scroll bg-white flex-1 flex flex-col"
    >
        @if (carrinhoService.quantidadeItens() > 0) {
            <div class="flex flex-col">
                @for (
                    item of carrinhoService.carrinho()?.itens;
                    track item.id
                ) {
                    <div
                        class="flex items-start gap-4 p-5 hover:bg-slate-50/80 transition-colors border-b border-slate-50 last:border-0 group/item relative"
                    >
                        <!-- Imagem do Produto -->
                        <div
                            class="w-16 h-16 bg-slate-100 rounded-xl border border-slate-200/60 flex items-center justify-center shrink-0 text-slate-400 overflow-hidden shadow-sm"
                        >
                            <!-- Troque o ícone pela imagem real (img tag) quando tiver -->
                            <i class="ph-duotone ph-image text-2xl"></i>
                        </div>

                        <!-- Detalhes do Produto -->
                        <div class="flex-1 min-w-0 pr-8">
                            <!-- pr-8 dá espaço para o botão de excluir não sobrepor o texto -->
                            <p
                                class="text-sm font-semibold text-slate-800 line-clamp-2 leading-snug mb-1"
                            >
                                {{ item.nomeProduto }}
                            </p>

                            <!-- Badge de Quantidade e Preço Unitário -->
                            <div
                                class="flex items-center text-xs text-slate-500"
                            >
                                <span
                                    class="font-medium bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded-md mr-1.5"
                                    >{{ item.quantidade }}x</span
                                >
                                <span>{{
                                    item.precoUnitario | currency: "BRL"
                                }}</span>
                            </div>
                        </div>

                        <!-- Preço Total do Item e Botão Remover na Direita -->
                        <div
                            class="flex flex-col items-end justify-between h-full absolute right-5 top-5 bottom-5"
                        >
                            <span class="text-sm font-bold text-slate-900">
                                {{
                                    item.precoUnitario * item.quantidade
                                        | currency: "BRL"
                                }}
                            </span>

                            <button
                                (click)="removerItem($event, item.id)"
                                class="text-slate-300 hover:text-red-500 hover:bg-red-50 p-1.5 rounded-lg transition-all opacity-0 group-hover/item:opacity-100 mt-auto"
                                title="Remover item"
                            >
                                <i class="ph-bold ph-trash text-base"></i>
                            </button>
                        </div>
                    </div>
                }
            </div>
        } @else {
            <!-- Empty State Melhorado -->
            <div
                class="flex-1 flex flex-col items-center justify-center text-center py-12 px-6"
            >
                <div
                    class="bg-slate-50 w-16 h-16 rounded-full flex items-center justify-center mb-4 border border-slate-100 shadow-sm"
                >
                    <i
                        class="ph-duotone ph-shopping-bag text-2xl text-slate-400"
                    ></i>
                </div>
                <p class="text-sm font-semibold text-slate-700">
                    Seu carrinho está vazio
                </p>
                <p
                    class="text-xs mt-1.5 text-slate-500 leading-relaxed max-w-[200px]"
                >
                    Explore nossos produtos e adicione itens para continuar.
                </p>
            </div>
        }
    </div>

    <!-- Rodapé -->
    <div
        class="p-5 bg-white border-t border-slate-100 shrink-0 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.02)]"
    >
        <div class="flex justify-between items-end mb-4">
            <span class="text-sm font-medium text-slate-500">Total</span>
            <span
                class="text-xl font-black text-slate-900 tracking-tight leading-none"
            >
                {{ carrinhoService.valorTotal() | currency: "BRL" }}
            </span>
        </div>

        <!-- Botão Finalizar Compra Dinâmico -->
        @if (carrinhoService.quantidadeItens() > 0) {
            <a
                routerLink="/checkout/carrinho"
                class="w-full bg-slate-900 hover:bg-slate-800 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm group active:scale-[0.98] shadow-md shadow-slate-900/20"
            >
                <span>Finalizar Compra</span>
                <i
                    class="ph-bold ph-arrow-right group-hover:translate-x-1 transition-transform"
                ></i>
            </a>
        } @else {
            <button
                disabled
                class="w-full bg-slate-50 text-slate-400 font-semibold py-3 px-4 rounded-xl cursor-not-allowed flex items-center justify-center gap-2 text-sm border border-slate-100"
            >
                <span>Carrinho Vazio</span>
            </button>
        }
    </div>
</div>
