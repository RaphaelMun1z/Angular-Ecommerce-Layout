@if (isSticky()) {
    <div class="h-[88px] md:h-[180px] w-full"></div>
}

<header
    [class]="
        isSticky()
            ? 'fixed top-0 left-0 w-full shadow-lg animate-slide-down z-50'
            : 'relative w-full z-40'
    "
    class="bg-brand text-white transition-all duration-300"
>
    @if (!isSticky()) {
    <div class="border-b border-white/20 hidden md:block">
        <div
            class="container mx-auto px-4 lg:px-8 py-2.5 flex justify-between items-center text-[11px] font-medium text-white/90"
        >
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-1.5">
                    <i class="ph ph-map-pin text-sm"></i>
                    <span>Av. Paulista, 1000, São Paulo, BR</span>
                </div>
                <div class="flex items-center space-x-1.5">
                    <i class="ph ph-phone text-sm"></i>
                    <span>+55 11 99999-9999</span>
                </div>
            </div>
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-3 text-sm opacity-90">
                    <a
                        href="#"
                        class="hover:text-white hover:opacity-100 transition"
                        ><i class="ph-fill ph-facebook-logo"></i
                    ></a>
                    <a
                        href="#"
                        class="hover:text-white hover:opacity-100 transition"
                        ><i class="ph-fill ph-twitter-logo"></i
                    ></a>
                    <a
                        href="#"
                        class="hover:text-white hover:opacity-100 transition"
                        ><i class="ph-fill ph-instagram-logo"></i
                    ></a>
                </div>
            </div>
        </div>
    </div>
    }

    <div>
        <div
            class="container mx-auto px-4 lg:px-8 flex justify-between items-center gap-4 transition-all duration-300"
            [class.py-6]="!isSticky()"
            [class.py-3]="isSticky()"
        >
            <div class="flex items-center gap-3">
                <div class="md:hidden">
                    <app-logo-menu-mobile-trigger></app-logo-menu-mobile-trigger>
                </div>

                <a
                    routerLink="/"
                    class="text-3xl font-extrabold tracking-tighter text-white cursor-pointer"
                >
                    e-shop<span class="text-yellow-400">.</span>
                </a>
            </div>

            <div class="hidden md:flex flex-1 max-w-2xl mx-12">
                <app-central-search-bar class="w-full"></app-central-search-bar>
            </div>

            <div class="flex items-center space-x-4 sm:space-x-6">
                <button
                    (click)="openMobileSearch()"
                    class="md:hidden text-white hover:text-white/80 transition-colors p-1"
                >
                    <i class="ph ph-magnifying-glass text-2xl"></i>
                </button>

                <app-wrapper-cart></app-wrapper-cart>

                @if (authService.isAuthenticated()) {
                    <app-my-account-area></app-my-account-area>
                } @else {
                    <a
                        routerLink="/login"
                        class="flex items-center gap-2 text-white hover:text-white/80 transition-all font-medium text-sm cursor-pointer group"
                    >
                        <i
                            class="ph ph-user text-3xl group-hover:opacity-80 transition"
                        ></i>
                        <div class="hidden lg:block text-[11px] leading-tight">
                            <p class="text-white/80">Visitante</p>
                            <p class="font-bold text-sm">Entrar</p>
                        </div>
                    </a>
                }
            </div>
        </div>
    </div>

    <nav
        class="border-t border-white/20 hidden md:block"
        [class.hidden]="isSticky()"
    >
        <div class="container mx-auto px-4 lg:px-8">
            <div class="flex justify-between items-center text-sm font-medium">
                <ul class="flex items-center">
                    <li class="relative">
                        <button
                            (click)="toggleCategoryMenu($event)"
                            class="flex items-center space-x-2 px-0 py-4 mr-8 hover:opacity-80 transition cursor-pointer outline-none"
                            [class.opacity-80]="isCategoryMenuOpen()"
                        >
                            <i class="ph ph-list text-lg"></i>
                            <span>Todas Categorias</span>
                        </button>

                        @if (isCategoryMenuOpen()) {
                            <div
                                class="absolute top-[100%] left-0 w-[800px] bg-white text-gray-800 shadow-2xl rounded-b-2xl border border-gray-100 z-50 animate-fade-in overflow-hidden cursor-default"
                            >
                                <div class="p-8 grid grid-cols-3 gap-8">
                                    <div class="col-span-2">
                                        <h3
                                            class="text-brand font-extrabold flex items-center gap-2 mb-4 border-b border-gray-100 pb-2 uppercase text-xs tracking-wider"
                                        >
                                            <i
                                                class="ph-fill ph-list-dashes"
                                            ></i>
                                            Departamentos
                                        </h3>

                                        <ul
                                            class="grid grid-cols-2 gap-x-8 gap-y-3"
                                        >
                                            @for (
                                                cat of categorias();
                                                track cat.id
                                            ) {
                                                <li class="group">
                                                    <a
                                                        routerLink="/produtos"
                                                        [queryParams]="{
                                                            categoria: cat.id,
                                                        }"
                                                        class="text-gray-500 hover:text-brand transition-colors flex items-center gap-2"
                                                    >
                                                        <i
                                                            class="ph ph-caret-right text-[10px] opacity-0 group-hover:opacity-100 transition-all"
                                                        ></i>
                                                        {{ cat.nome }}
                                                    </a>
                                                </li>
                                            } @empty {
                                                <li
                                                    class="col-span-2 text-gray-400 py-2 italic text-sm"
                                                >
                                                    Carregando categorias...
                                                </li>
                                            }
                                        </ul>
                                    </div>

                                    <div
                                        class="relative rounded-xl overflow-hidden group cursor-pointer"
                                        routerLink="/produtos"
                                        [queryParams]="{ filtro: 'promocao' }"
                                    >
                                        <div
                                            class="absolute inset-0 bg-gradient-to-br from-brand to-brand-dark opacity-90 group-hover:opacity-100 transition-opacity"
                                        ></div>
                                        <div
                                            class="relative z-10 p-6 flex flex-col justify-between h-full text-white"
                                        >
                                            <div>
                                                <span
                                                    class="bg-yellow-400 text-gray-900 text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-widest mb-2 inline-block"
                                                    >Flash Sale</span
                                                >
                                                <h4
                                                    class="text-xl font-black leading-tight mt-2 mb-1"
                                                >
                                                    Promoção<br />de Verão
                                                </h4>
                                                <p
                                                    class="text-xs text-white/80"
                                                >
                                                    Até 50% de desconto em
                                                    telemóveis.
                                                </p>
                                            </div>
                                            <div
                                                class="mt-4 flex items-center text-sm font-bold gap-1 group-hover:gap-2 transition-all"
                                            >
                                                Ver Ofertas
                                                <i
                                                    class="ph-bold ph-arrow-right"
                                                ></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </li>

                    <li>
                        <a
                            routerLink="/produtos"
                            class="px-5 py-4 inline-block hover:opacity-80 transition cursor-pointer"
                            >Produtos</a
                        >
                    </li>
                    <li>
                        <a
                            routerLink="/sobre-nos"
                            class="px-5 py-4 inline-block hover:opacity-80 transition cursor-pointer"
                            >Sobre Nós</a
                        >
                    </li>
                    <li>
                        <a
                            routerLink="/faq"
                            class="px-5 py-4 inline-block hover:opacity-80 transition cursor-pointer"
                            >FAQ</a
                        >
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

@if (isMobileSearchOpen()) {
    <div
        class="fixed inset-0 bg-black/50 z-[60] md:hidden animate-fade-in"
        (click)="closeMobileSearch()"
    ></div>
    <div
        class="fixed top-0 left-0 w-full bg-white z-[70] p-4 shadow-md md:hidden animate-slide-down flex items-center gap-4"
    >
        <button
            (click)="closeMobileSearch()"
            class="text-gray-500 p-2 hover:bg-gray-100 rounded-full shrink-0"
        >
            <i class="ph ph-arrow-left text-2xl"></i>
        </button>
        <div class="flex-1 text-gray-800">
            <app-central-search-bar></app-central-search-bar>
        </div>
    </div>
}
